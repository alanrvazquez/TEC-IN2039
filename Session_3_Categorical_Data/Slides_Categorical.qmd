---
title: |
   | Sesi√≥n 3: 
   | Variables Categ√≥ricas  
author: 
  - name: Alan R. V√°zquez
    email: alanrvazquez@tec.mx
    affiliations:
      - name: Tecnol√≥gico de Monterrey
format: 
  revealjs:
    chalkboard: true
    multiplex: true
editor: visual
slide-number: True
logo: IN2039_logo.png
css: style.css
---

## Los T√≥picos de Hoy

[*Enfocarnos en 1 variable categ√≥rica.*]{style="color:darkblue;"}

<br/>

::: columns
::: {.column width="50%"}
1.  Res√∫menes estad√≠sticos
:::

::: {.column width="50%"}
2.  Tipos de gr√°ficas
:::
:::

::: columns
::: {.column width="30%"}
3.  Actividad
:::

::: {.column width="70%"}
:::
:::

## Primero lo primero

Hoy usaremos R para construir graficas y tablas. Para esto, utilizaremos las librerias que ya vimos antes como `ggplot2`, `ggformula`, y `readxl`.

<br/>

Carguemoslas en R antes de comenzar.

```{r}
#| echo: true
#| output: false

library(readxl)
library(ggplot2)
library(ggformula)
```

## Penguins Dataset

Ilustraremos los conceptos de hoy utlizando el conjunto de datos `penguins.xlsx`.

::: columns
::: {.column width="68%"}
Cargalo en R usando el siguiente c√≥digo.

```{r}
#| output: false
#| echo: true
#| code-overflow: wrap

penguins_data <- read_excel("penguins.xlsx")
```
:::

::: {.column width="32%"}
![](images/clipboard-1776523589.png){fig-align="right" width="561"}
:::
:::

Recuerda que el archivo debe de estar en la misma carpeta que tu c√≥digo.

## 

![](images/clipboard-3758853900.png)

## 

![](images/clipboard-3461599711.png){fig-align="center" width="647"}

## Asegurate que R sabe que la variable es categorica

Antes de comenzar, debemos de checar si R reconoce las variables como categ√≥ricas o num√©ricas.

> En R, las variables categoricas se conocen como `factor` y las variables num√©ricas como `numeric`.

Le puedes pregunar a R por una variable en particular, por ejemplo, `species`, as√≠:

```{r}
#| echo: true
#| output: true

is.factor(penguins_data$species)
```

## R no es inteligente

A pesar de que la variable `species` claramente es categ√≥rica, R no reconoce esto. Para asegurarnos que R sepa que la variable es categ√≥rica, hacemos lo siguiente

```{r}
#| echo: true
#| output: true

penguins_data$species <- factor(penguins_data$species)
```

<br/>

Preguntemosle a R el tipo de variable otra vez.

```{r}
#| echo: true
#| output: true

is.factor(penguins_data$species)
```

## Te recomiendo hacer lo mismo para las otras variables categ√≥ricas

```{r}
#| echo: true
#| output: true

penguins_data$island <- factor(penguins_data$island)
penguins_data$sex <- factor(penguins_data$sex)
penguins_data$year <- factor(penguins_data$year)
```

## Resumenes Estad√≠sticos

> Un **resum√©n estad√≠stico** nos ayuda a resumir un conjunto de observaciones de una manera simple.

Los res√∫menes num√©ricos m√°s utilizados para datos categ√≥ricos son las frecuencias y las frecuencias relativas.

-   La [**frecuencia**]{style="color:darkblue;"} de una categor√≠a es la cantidad de elementos de muestra que pertenecen a esa categor√≠a.

-   La [**frecuencia relativa**]{style="color:darkblue;"} es la frecuencia dividida por el n√∫mero total de observaciones.

## Tabla de Frecuencia

Resume una variable categorica contando los valores por categor√≠a.

::: columns
::: {.column width="50%"}
```{r}
#| echo: true
#| output: true
#| code-overflow: wrap

table(penguins_data$species)
```
:::

::: {.column width="50%"}
| **Especie** | **Frecuencia** |
|-------------|----------------|
| Adelie      | 152            |
| Chinstrap   | 68             |
| Gentoo      | 124            |
| **Total**   | **344**        |
:::
:::

-   **Frecuencia**: N√∫mero de observaciones en cada categor√≠a.

-   **Total**: Suma total de observaciones.

::: notes
1.  Ventajas de las frequencias.

2.  Resumen claro y conciso de los datos categ√≥ricos.

3.  Facilita la identificaci√≥n de patrones y tendencias.

4.  Ayuda en la toma de decisiones informadas.
:::

## Tabla de Frecuencia Relativa

Resume una variable categorica calculando la *proporci√≥n de valores* por categor√≠a.

::: columns
::: {.column width="55%"}
```{r}
#| echo: true
#| output: true
#| code-overflow: wrap

# Calcula el n√∫mero de observaciones.
n <- nrow(penguins_data) 

# Calcula la frequencia relativa.
table(penguins_data$species)/n
```
:::

::: {.column width="45%"}
| **Especie** | **Frecuencia relativa** |
|-------------|-------------------------|
| Adelie      | 0.4418605               |
| Chinstrap   | 0.1976744               |
| Gentoo      | 0.3604651               |
| **Suma**    | **1**                   |
:::
:::

-   **Frecuencia relativa**: N√∫mero de observaciones en cada categor√≠a dividida por el total.

::: notes
La ventaja de la frequencia relativa es que se puede interpretar como una probabilidad. Lo que da mas informaci√≥n.
:::

## Gr√°fica de Barras

Representa visualmente una tabla de frequencias or frequencias relativas.

La frecuencia (o frequencia relativa) se representa por una barra de altura proporcional.

Puedes construir una grafica de barras usando la funcion `gf_bar()` as√≠:

```{r}
#| echo: true
#| output: true
#| fig-align: center
#| code-overflow: wrap
#| output-location: slide

gf_bar( ~ species, data = penguins_data)
```

## 

Si quieres graficar la frequencia relativa, usa la funci√≥n `gf_percents`.

```{r}
#| echo: true
#| output: true
#| fig-align: center
#| code-overflow: wrap

gf_percents( ~ species, data = penguins_data)
```

## Actividad (*solo* mode)

Usando las herramientas para gr√°ficos en ggplot, modifica el c√≥digo anterior para que la gr√°fica se vea asi.

```{r}
#| echo: false
#| output: true
#| fig-height: 4
#| fig-align: center

gf_percents( ~ species, data = penguins_data, fill = ~species) + labs(title = "Proporciones de ping√ºinos", subtitle = "Distribuci√≥n ping√ºinos en Adelie, Chinstrap, and Gentoo", x = "Tipo de especie", y = "Frecuencia relativa", fill = "Especie") 

```

```{r}
countdown::countdown(minutes = 10)
```

## Gr√°fico circular

::: columns
::: {.column width="50%"}
-   Se construye dividiendo un c√≠rculo en varias porciones que representan las categor√≠as de la variable.

-   La porci√≥n de una categoria es su frequencia relativa.

-   Este gr√°fico te permite dar un vistazo r√°pido a las proporciones de cada categor√≠a.
:::

::: {.column width="50%"}
![](images/clipboard-800609446.png)
:::
:::

::: notes
Pie charts versus bar charts.

**Bar charts can serve as a good way to show comparisons between categories**. It is generally observed that new trends tend to shy away from using pie charts, as it is difficult for the human eye to judge the exact angle that shows the value of a category in a pie chart.
:::

## Actividad (*cooperative* mode)

[Preguntale a ChatGPT]{style="color:darkgreen;"}

1.  Ve ChatGPT en <https://chat.openai.com/>
2.  Pidele a ChatGPT que te muestre como generar una gr√°fica de circular (o de *pastel*) usando **ggplot2** en R.
3.  Adapta tu c√≥gigo para producir una gr√°fica circular de la variable `island` en `penguin_data`.

```{r}
countdown::countdown(minutes = 10)
```

# Transformando variables categ√≥ricas

## Aplica el Principio 3

> *Enriquece con informaci√≥n adicional.*

Podemos mejorar gr√°ficas de variables categ√≥ricas usando estas t√©cnicas:

-   Re-etiquetar las categor√≠as para que sean m√°s informativas.

-   Re-ordenar las categor√≠as para que sigan su orden natural.

-   Colapsar categor√≠as para simplificar una visualizaci√≥n.

## Ejemplo: Boston Housing Dataset

Este conjunto de datos contiene informaci√≥n recopilada por el Servicio del Censo de EE. UU. sobre viviendas en el √°rea de Boston, Massachusetts.

::: columns
::: {.column width="60%"}
![](images/boston_dataset.png)
:::

::: {.column width="40%"}
![](images/clipboard-3653087831.png)
:::
:::

## 

Los datos estan en el archivo `Boston_dataset.xlsx`. Cargalos en R usando el siguiente comando.

```{r}
#| echo: true
#| output: true

Boston_dataset <- read_excel("Boston_dataset.xlsx")
head(Boston_dataset)
```

Nos concentraremos en las siguientes variables

-   `chas` : Si la casa limita con el r√≠o Charles (1: Si y 0: No)

-   `rad` : Indice de accesibilidad a carreteras radiales (`Low`, `Medium`, `High`).

## Recuerda...

Asegurate de que R sabe que esas variables son categ√≥ricas.

```{r}
#| echo: true
#| output: true

Boston_dataset$chas <- factor(Boston_dataset$chas)
Boston_dataset$rad <- factor(Boston_dataset$rad)
```

## Re-etiquetado

Vamos a construir una gr√°fica de barras de `chas`.

```{r}
#| echo: true
#| output: true
#| fig-pos: center

gf_percents( ~ chas, data = Boston_dataset)

```

Sin embargo, las categor√≠as en la gr√°fica no son informativas.

## 

Lo mejor es re-nombrar las categor√≠as de la variable `chas` para que la gr√°fica de barras de mas informaci√≥n al usuario.

1.  Verifica los nombres de las categor√≠as en la variable.

    ```{r}
    #| echo: true
    #| output: true

    levels(Boston_dataset$chas)
    ```

```{=html}
<!-- -->
```
2.  Re-emplaza por nombres apropiados.

    ```{r}
    #| echo: true
    #| output: true

    # Usa un vector para denotar los normbres.
    levels(Boston_dataset$chas) <- c("No", "Si")
    ```

## Veamos que sucede ahora.

```{r}
#| echo: true
#| output: true
#| fig-pos: center 

gf_percents( ~ chas, data = Boston_dataset)
```

Mucho mejor üòÉ

## Re-ordenar categor√≠as

Ahora, construyamos una gr√°fica de barras de `rad`.

```{r}
#| echo: true
#| output: true
#| fig-pos: center 

gf_percents( ~ rad, data = Boston_dataset)
```

Las categor√≠as no siguien un orden natural de izquierda a derecha: `Low`, `Medium`, y `High`.

## 

Para tener el orden de las categor√≠as deseado, debemos de ser m√°s expl√≠citos al momento de definir la variable categ√≥rica en R.

```{r}
#| echo: true
#| output: true
#| fig-pos: center

Boston_dataset$rad <- factor(Boston_dataset$rad, levels = c("Low", "Medium", "High"))
gf_percents( ~ rad, data = Boston_dataset)
```

Mucho mejor üòÉ

## Colapsando categor√≠as

Let‚Äôs create a new column, called `play`, to represent the groups of dogs whose ‚Äúpurpose‚Äù is to play (or not). (This is a fictitious distinction used for demonstration purposes.) This category consists of the toy and non-sporting breeds.

The new feature, `play`, is a transformation of the feature `group` that collapses categories: toy and non-sporting are combined into one category, and the remaining categories are placed in a second, non-play category.

The boolean (`bool`) storage type is useful to indicate the presence or absence of this characteristic:

```{r}

```

## 

Representing a two-category qualitative feature as a boolean has a few advantages. For example, the mean of `play` makes sense because it returns the fraction of `True` values. When booleans are used for numeric calculations, `True` becomes 1 and `False` becomes 0:

```{r}

```

## Convertir de quantitativo a ordinal

Finally, another transformation that we sometimes find useful is to convert numeric values into categories.

For example, we might collapse the values in `ailments` into categories: 0, 1, 2, 3, 4+. In other words, we turn `ailments` from a quantitative feature into an ordinal feature with the mapping 0‚Üí0, 1‚Üí1, 2‚Üí2, 3‚Üí3, and any value 4 or larger‚Üí4+.

We might want to make this transformation because few breeds have more than three genetic ailments. This simplification can be clearer and adequate for an investigation.

## Sin embargo...

When we convert a quantitative feature to ordinal, we lose information. We can‚Äôt go back. That is, if we know the number of ailments for a breed is four or more, we can‚Äôt re-create the actual numeric value.

The same thing happens when we collapse categories. For this reason, it‚Äôs a good practice to keep the original feature.

If we need to check our work or change categories, we can document and re-create our steps.
